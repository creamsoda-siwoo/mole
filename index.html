<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‘ë”ì§€ ì¡ê¸° ê²Œì„</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”¨</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Jua', sans-serif;
      }
    </style>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, useMemo, memo, StrictMode } = React;

      // --- Game Configuration ---
      const LEVEL_CONFIG = {
          1: { scoreToPass: 10, interval: 1000, duration: 30 },
          2: { scoreToPass: 15, interval: 850, duration: 30 },
          3: { scoreToPass: 20, interval: 700, duration: 25 },
          4: { scoreToPass: 25, interval: 550, duration: 25 },
          5: { scoreToPass: 30, interval: 400, duration: 20 },
      };
      const MAX_LEVEL = Object.keys(LEVEL_CONFIG).length;

      const DIFFICULTY_MODIFIERS = {
        'ì‰¬ì›€': { interval: 1.2, duration: 1.2, score: 0.8 },
        'ë³´í†µ': { interval: 1.0, duration: 1.0, score: 1.0 },
        'ì–´ë ¤ì›€': { interval: 0.8, duration: 0.8, score: 1.2 },
      };

      const JOB_CONFIG = {
          'ë†ë¶€': { name: 'ë†ë¶€', description: 'ë‘ë”ì§€ 10ë§ˆë¦¬ë§ˆë‹¤ +2 ë³´ë„ˆìŠ¤ ì ìˆ˜', icon: 'ğŸ‘¨â€ğŸŒ¾' },
          'ê´‘ë¶€': { name: 'ê´‘ë¶€', description: 'í­íƒ„ íŒ¨ë„í‹° ê°ì†Œ (-1ì )', icon: 'â›ï¸' },
          'ì‹œê°„ ì—¬í–‰ì': { name: 'ì‹œê°„ ì—¬í–‰ì', description: '5ì´ˆê°„ ê²Œì„ ì†ë„ 50% ê°ì†Œ (ì¿¨íƒ€ì„ 20ì´ˆ)', icon: 'â³' },
      };

      const ITEM_PROBABILITY = 0.1; // 10%
      const BOMB_PROBABILITY = 0.08; // 8%

      // --- SVG Icons ---
      const HammerIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg> );
      const TimerIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> );
      const BombIcon = ({ isVisible }) => (
          <div className={`relative w-2/3 h-2/3 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}`}>
              <div className="absolute inset-0 bg-gray-800 rounded-full border-4 border-black flex justify-center items-start">
                  <div className="w-2 h-4 bg-gray-500 rounded-t-sm"></div>
              </div>
          </div>
      );
      const ClockIcon = ({ isVisible }) => (
          <div className={`relative w-2/3 h-2/3 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}`}>
              <div className="absolute inset-0 bg-blue-400 rounded-full border-4 border-blue-800 flex justify-center items-center">
                   <svg xmlns="http://www.w3.org/2000/svg" className="h-2/3 w-2/3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
              </div>
          </div>
      );

      // --- Child Components ---
      const Mole = memo(({ isVisible }) => (
        <div className={`relative w-2/3 h-2/3 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}`}>
            <div className="absolute inset-0 bg-amber-700 rounded-full border-4 border-black/80">
                <div className="absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full"></div>
                <div className="absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full"></div>
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm"></div>
            </div>
        </div>
      ));

      const Hole = memo(({ entityType, onWhack, canWhack }) => {
          const isVisible = entityType !== 'empty';
          const renderEntity = () => {
              switch (entityType) {
                  case 'mole': return <Mole isVisible={isVisible} />;
                  case 'bomb': return <BombIcon isVisible={isVisible} />;
                  case 'clock': return <ClockIcon isVisible={isVisible} />;
                  default: return null;
              }
          };
          return (
            <div
              className="w-full h-full bg-yellow-900/60 rounded-full overflow-hidden flex items-end justify-center pt-4 shadow-inner"
              onClick={canWhack && isVisible ? onWhack : undefined}
            >
              {renderEntity()}
            </div>
          );
      });

      // --- Main App Component ---
      function App() {
        const [gameState, setGameState] = useState('idle');
        const [score, setScore] = useState(0);
        const [level, setLevel] = useState(1);
        const [difficulty, setDifficulty] = useState('ë³´í†µ');
        const [gridSize, setGridSize] = useState(9);
        const [entities, setEntities] = useState(new Array(gridSize).fill('empty'));
        const [highScore, setHighScore] = useState(() => Number(localStorage.getItem('whac-a-mole-highscore') || 0));
        const [job, setJob] = useState('ë†ë¶€');
        
        // Job specific states
        const [molesWhacked, setMolesWhacked] = useState(0);
        const [isSkillActive, setIsSkillActive] = useState(false);
        const [skillCooldown, setSkillCooldown] = useState(0);
        const [scorePulse, setScorePulse] = useState(false);

        const gridDimension = useMemo(() => Math.sqrt(gridSize), [gridSize]);
        
        const timeDilation = isSkillActive ? 1.5 : 1.0;

        const currentLevelConfig = useMemo(() => {
          const baseConfig = LEVEL_CONFIG[level];
          const modifier = DIFFICULTY_MODIFIERS[difficulty];
          return {
            interval: baseConfig.interval * modifier.interval,
            duration: Math.round(baseConfig.duration * modifier.duration),
            scoreToPass: Math.round(baseConfig.scoreToPass * modifier.score),
          };
        }, [level, difficulty]);
        
        const [timeLeft, setTimeLeft] = useState(currentLevelConfig.duration);

        useEffect(() => {
          setEntities(new Array(gridSize).fill('empty'));
        }, [gridSize, difficulty, job]);

        // Game timer & skill cooldown effect
        useEffect(() => {
          if (gameState !== 'playing') return;

          if (timeLeft <= 0) {
            setGameState(score >= currentLevelConfig.scoreToPass ? 'levelComplete' : 'gameOver');
            setEntities(new Array(gridSize).fill('empty'));
            if (score > highScore) {
                setHighScore(score);
                localStorage.setItem('whac-a-mole-highscore', score.toString());
            }
            return;
          }

          const timerId = setTimeout(() => {
              setTimeLeft(timeLeft - 1);
              if (skillCooldown > 0) {
                  setSkillCooldown(prev => prev - 1);
              }
          }, 1000 * timeDilation);

          return () => clearTimeout(timerId);
        }, [gameState, timeLeft, score, highScore, currentLevelConfig, gridSize, skillCooldown, timeDilation]);

        // Entity generation effect
        useEffect(() => {
          if (gameState !== 'playing') return;

          const moleIntervalId = setInterval(() => {
            setEntities(() => {
                const newEntities = new Array(gridSize).fill('empty');
                const numToShow = Math.min(Math.floor(level / 2) + Math.floor(gridSize / 9), Math.floor(gridSize / 2));
                let availableSpots = Array.from(Array(gridSize).keys());

                for(let i=0; i < numToShow; i++) {
                    if (availableSpots.length === 0) break;
                    const spotIndexInAvailable = Math.floor(Math.random() * availableSpots.length);
                    const spotIndex = availableSpots.splice(spotIndexInAvailable, 1)[0];
                    const rand = Math.random();
                    if (rand < BOMB_PROBABILITY) newEntities[spotIndex] = 'bomb';
                    else if (rand < BOMB_PROBABILITY + ITEM_PROBABILITY) newEntities[spotIndex] = 'clock';
                    else newEntities[spotIndex] = 'mole';
                }
                return newEntities;
            });
          }, currentLevelConfig.interval * timeDilation);

          return () => clearInterval(moleIntervalId);
        }, [gameState, currentLevelConfig, gridSize, level, timeDilation]);
        
        const setupLevel = useCallback((targetLevel, initialScore = 0) => {
          setLevel(targetLevel);
          setScore(initialScore);
          setMolesWhacked(0);
          setSkillCooldown(0);
          setIsSkillActive(false);
          const newConfig = LEVEL_CONFIG[targetLevel];
          const modifier = DIFFICULTY_MODIFIERS[difficulty];
          setTimeLeft(Math.round(newConfig.duration * modifier.duration));
          setGameState('playing');
        }, [difficulty]);

        const startGame = useCallback(() => setupLevel(1), [setupLevel]);
        
        const startNextLevel = useCallback(() => {
          if (level < MAX_LEVEL) {
            setupLevel(level + 1, score);
          } else {
            setGameState('gameOver');
          }
        }, [level, setupLevel, score]);
        
        const restartGame = useCallback(() => {
            setGameState('idle');
            const newConfig = LEVEL_CONFIG[1];
            const modifier = DIFFICULTY_MODIFIERS[difficulty];
            setTimeLeft(Math.round(newConfig.duration * modifier.duration));
            setScore(0);
            setLevel(1);
        }, [difficulty]);

        const togglePause = useCallback(() => {
          setGameState(prev => (prev === 'playing' ? 'paused' : 'playing'));
        }, []);

        const triggerScorePulse = () => {
          setScorePulse(true);
          setTimeout(() => setScorePulse(false), 200);
        }

        const whackHole = useCallback((index) => {
          const entity = entities[index];
          if (entity !== 'empty') {
            let scoreChange = 0;
            switch (entity) {
              case 'mole':
                scoreChange = 1;
                const newWhackedCount = molesWhacked + 1;
                setMolesWhacked(newWhackedCount);
                if (job === 'ë†ë¶€' && newWhackedCount % 10 === 0) {
                  scoreChange += 2;
                }
                break;
              case 'clock':
                setTimeLeft(prevTime => prevTime + 2);
                break;
              case 'bomb':
                const penalty = job === 'ê´‘ë¶€' ? 1 : 2;
                scoreChange = -penalty;
                break;
            }
            
            if (scoreChange !== 0) {
                setScore(prevScore => Math.max(0, prevScore + scoreChange));
                triggerScorePulse();
            }

            setEntities(prevEntities => {
              const newEntities = [...prevEntities];
              newEntities[index] = 'empty';
              return newEntities;
            });
          }
        }, [entities, job, molesWhacked]);

        const handleSkillUse = () => {
          if (job === 'ì‹œê°„ ì—¬í–‰ì' && skillCooldown === 0 && gameState === 'playing') {
            setIsSkillActive(true);
            setSkillCooldown(20);
            setTimeout(() => setIsSkillActive(false), 5000);
          }
        }

        const handleGridSizeChange = (newSize) => {
          if (gameState === 'idle') setGridSize(newSize);
        };
        
        const handleDifficultyChange = (newDifficulty) => {
           if (gameState === 'idle') setDifficulty(newDifficulty);
        }

        const handleJobChange = (newJob) => {
          if (gameState === 'idle') setJob(newJob);
        }
        
        const renderModalContent = () => {
          switch (gameState) {
            case 'paused':
              return (
                <div className="text-center bg-black/70 p-8 rounded-2xl shadow-xl border-4 border-gray-500 flex flex-col items-center gap-4">
                    <h2 className="text-5xl font-bold text-white drop-shadow-lg mb-4">ì¼ì‹œì •ì§€</h2>
                    <button onClick={togglePause} className="w-48 px-6 py-3 bg-green-500 text-white font-bold text-xl rounded-lg shadow-md hover:bg-green-600 transition-transform transform hover:scale-105">ê³„ì†í•˜ê¸°</button>
                    <button onClick={restartGame} className="w-48 px-6 py-3 bg-blue-500 text-white font-bold text-xl rounded-lg shadow-md hover:bg-blue-600 transition-transform transform hover:scale-105">ë‹¤ì‹œ ì‹œì‘</button>
                    <button onClick={restartGame} className="w-48 px-6 py-3 bg-red-500 text-white font-bold text-xl rounded-lg shadow-md hover:bg-red-600 transition-transform transform hover:scale-105">ê²Œì„ ì¢…ë£Œ</button>
                </div>
              );
            case 'levelComplete':
              return (
                <div className="text-center bg-blue-100 p-8 rounded-2xl shadow-xl border-4 border-blue-400">
                  <h2 className="text-4xl font-bold text-blue-700">ë ˆë²¨ {level} í´ë¦¬ì–´!</h2>
                  <p className="text-xl mt-2 text-blue-600">ì ìˆ˜: {score}ì </p>
                  {level < MAX_LEVEL ? (
                    <p className="text-lg mt-1">ë‹¤ìŒ ë ˆë²¨ë¡œ ì§„í–‰í•˜ì„¸ìš”!</p>
                  ) : (
                     <p className="text-lg mt-1 text-green-600 font-bold">ëª¨ë“  ë ˆë²¨ í´ë¦¬ì–´! ì¶•í•˜í•©ë‹ˆë‹¤!</p>
                  )}
                </div>
              );
            case 'gameOver':
              return (
                 <div className="text-center bg-red-100 p-8 rounded-2xl shadow-xl border-4 border-red-400">
                  <h2 className="text-4xl font-bold text-red-700">ê²Œì„ ì¢…ë£Œ!</h2>
                  <p className="text-xl mt-2 text-red-600">ë‹¹ì‹ ì˜ ì ìˆ˜ëŠ” {score}ì  ì…ë‹ˆë‹¤.</p>
                  {score < currentLevelConfig.scoreToPass && (
                     <p className="text-lg mt-1 text-red-500">ëª©í‘œ ì ìˆ˜({currentLevelConfig.scoreToPass}ì )ë¥¼ ë‹¬ì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
                  )}
                </div>
              );
            default:
              return null;
          }
        };

        const renderMainButton = () => {
            let text = '';
            let action = () => {};

            switch(gameState) {
                case 'idle': text = 'ê²Œì„ ì‹œì‘'; action = startGame; break;
                case 'playing': text = 'ì¼ì‹œì •ì§€'; action = togglePause; break;
                case 'paused': return null; // Pause menu has its own continue button
                case 'levelComplete':
                    text = level < MAX_LEVEL ? 'ë‹¤ìŒ ë‹¨ê³„' : 'ë‹¤ì‹œí•˜ê¸°';
                    action = level < MAX_LEVEL ? startNextLevel : restartGame;
                    break;
                case 'gameOver': text = 'ë‹¤ì‹œ ì‹œì‘'; action = restartGame; break;
            }

            if (!text) return null;

            return (
               <button 
                  onClick={action} 
                  className="px-10 py-4 bg-orange-500 text-white font-bold text-2xl rounded-xl shadow-lg
                             hover:bg-orange-600 transition-all duration-200 transform hover:scale-105"
                >
                  {text}
                </button>
            );
        }

        return (
          <main className="min-h-screen bg-green-200 flex flex-col items-center justify-center p-4 text-amber-900 select-none">
            <div className="w-full max-w-2xl mx-auto bg-amber-200/70 p-4 sm:p-8 rounded-3xl shadow-2xl border-8 border-amber-800/50">
              
              <header className="text-center mb-4">
                <h1 className="text-4xl sm:text-6xl font-extrabold tracking-wider">ë‘ë”ì§€ ì¡ê¸°</h1>
                <p className="text-lg text-amber-800 mt-1">ì§ì—…ì„ ì„ íƒí•˜ê³  ìµœê³  ì ìˆ˜ì— ë„ì „í•˜ì„¸ìš”!</p>
              </header>

              <div className="grid grid-cols-2 gap-4 bg-amber-100 rounded-lg p-3 sm:p-4 mb-2 text-xl sm:text-2xl font-bold shadow-md">
                  <div className={`flex items-center col-span-1 transition-transform duration-200 ${scorePulse ? 'scale-125 text-yellow-500' : ''}`}><HammerIcon /><span>ì ìˆ˜: {score}</span></div>
                  <div className="flex items-center col-span-1 justify-end"><TimerIcon /><span>ì‹œê°„: {timeLeft}</span></div>
                  <div className="col-span-2 text-center text-base sm:text-lg text-amber-700">
                    <span>ë ˆë²¨: {level} ({difficulty})</span>
                    <span className="mx-2 sm:mx-4">|</span>
                    <span>ì§ì—…: {job}</span>
                    <span className="mx-2 sm:mx-4">|</span>
                    <span>ëª©í‘œ: {currentLevelConfig.scoreToPass}ì </span>
                  </div>
              </div>
              <div className="text-center text-base sm:text-lg text-amber-700 bg-amber-100 rounded-lg p-2 mb-4 shadow-md">
                <span>ìµœê³  ì ìˆ˜: {highScore}</span>
              </div>

              {gameState === 'idle' && (
                <div className="text-center my-4 p-3 bg-amber-100/50 rounded-lg space-y-4">
                  <div>
                    <h3 className="font-bold text-lg mb-2">ì§ì—… ì„ íƒ</h3>
                    <div className="grid grid-cols-3 gap-2 sm:gap-4">
                      {Object.keys(JOB_CONFIG).map(j => (
                        <button key={j} onClick={() => handleJobChange(j)} className={`p-2 sm:p-4 text-sm sm:text-base border-4 rounded-lg transition-all duration-200 ${job === j ? 'bg-orange-500 text-white border-orange-700 scale-105 shadow-lg' : 'bg-white text-amber-900 border-gray-200 hover:bg-gray-100'}`}>
                          <div className="text-2xl sm:text-4xl">{JOB_CONFIG[j].icon}</div>
                          <div className="font-bold mt-1">{JOB_CONFIG[j].name}</div>
                          <div className="text-xs mt-1 hidden sm:block">{JOB_CONFIG[j].description}</div>
                        </button>
                      ))}
                    </div>
                  </div>
                  <div className="grid sm:grid-cols-2 gap-4 pt-4">
                    <div>
                        <h3 className="font-bold text-lg mb-2">ë‚œì´ë„ ì„ íƒ</h3>
                        <div className="inline-flex rounded-md shadow-sm" role="group">
                            {Object.keys(DIFFICULTY_MODIFIERS).map(d => (
                                <button key={d} onClick={() => handleDifficultyChange(d)} type="button" className={`px-4 py-2 text-sm font-medium border first:rounded-l-lg last:rounded-r-lg ${difficulty === d ? 'bg-orange-500 text-white border-orange-600' : 'bg-white text-amber-900 border-gray-200 hover:bg-gray-100'}`}>{d}</button>
                            ))}
                        </div>
                    </div>
                    <div>
                        <h3 className="font-bold text-lg mb-2">ê²Œì„íŒ í¬ê¸° ì„ íƒ</h3>
                        <select 
                          value={gridSize} 
                          onChange={(e) => handleGridSizeChange(Number(e.target.value))}
                          className="px-4 py-2 text-sm font-medium rounded-lg border bg-white text-amber-900 border-gray-200 hover:bg-gray-100 focus:ring-2 focus:ring-orange-500"
                        >
                          {Array.from({ length: 9 }, (_, i) => i + 3).map(size => (
                            <option key={size} value={size * size}>{size} x {size}</option>
                          ))}
                        </select>
                    </div>
                  </div>
                </div>
              )}
              
              <div className="relative">
                <div 
                  style={{ gridTemplateColumns: `repeat(${gridDimension}, 1fr)` }}
                  className={`grid gap-1 sm:gap-2 w-full aspect-square bg-lime-700 p-2 sm:p-4 rounded-2xl shadow-inner
                  ${gameState === 'playing' ? "cursor-[url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"48\" viewport=\"0 0 100 100\" style=\"fill:black;font-size:24px;\"><text y=\"50%\">ğŸ”¨</text></svg>'),_auto]" : "cursor-default"}`}
                >
                  {entities.map((entityType, index) => (
                    <Hole 
                      key={index} 
                      entityType={entityType} 
                      onWhack={() => whackHole(index)}
                      canWhack={gameState === 'playing'}
                    />
                  ))}
                </div>
                { (gameState === 'paused' || gameState === 'levelComplete' || gameState === 'gameOver') && (
                  <div className="absolute inset-0 bg-black/50 flex items-center justify-center rounded-2xl p-4">
                    {renderModalContent()}
                  </div>
                )}
              </div>
              
              <div className="mt-8 text-center flex justify-around items-center">
                {renderMainButton()}
                {job === 'ì‹œê°„ ì—¬í–‰ì' && gameState === 'playing' && (
                  <button
                      onClick={handleSkillUse}
                      disabled={skillCooldown > 0}
                      className={`px-6 py-3 text-white font-bold text-lg rounded-xl shadow-lg transition-all duration-200 transform
                      ${skillCooldown > 0 ? 'bg-gray-500 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-700 hover:scale-105'}
                      ${isSkillActive ? 'animate-pulse ring-4 ring-purple-300' : ''}`}
                  >
                      {skillCooldown > 0 ? `ì¿¨íƒ€ì„: ${skillCooldown}ì´ˆ` : 'ì‹œê°„ ì™œê³¡'}
                  </button>
                )}
              </div>
            </div>
          </main>
        );
      }

      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <StrictMode>
          <App />
        </StrictMode>
      );
    </script>
</body>
</html>
