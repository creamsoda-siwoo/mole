
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÎëêÎçîÏßÄ Ïû°Í∏∞ Í≤åÏûÑ</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23654321'/%3E%3Ccircle cx='50' cy='60' r='35' fill='%23D2B48C'/%3E%3Ccircle cx='35' cy='50' r='5' fill='black'/%3E%3Ccircle cx='65' cy='50' r='5' fill='black'/%3E%3Ccircle cx='50' cy='70' r='8' fill='%23FFC0CB'/%3E%3C/svg%3E" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .fever-active {
            box-shadow: 0 0 25px 10px rgba(255, 165, 0, 0.8), 0 0 10px 5px rgba(255, 69, 0, 0.7);
        }
        .fever-text {
            animation: fever-text-animation 0.5s ease-in-out infinite alternate;
        }
        @keyframes fever-text-animation {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(1.1); opacity: 0.8; }
        }
        .event-text {
            animation: event-text-animation 3s forwards;
        }
        @keyframes event-text-animation {
            0% { transform: translateY(-100%) scale(0.5); opacity: 0; }
            30% { transform: translateY(0) scale(1.1); opacity: 1; }
            70% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(100%) scale(0.5); opacity: 0; }
        }
        .mystery-box-reward {
            animation: mystery-box-reward-animation 2.5s forwards;
        }
        @keyframes mystery-box-reward-animation {
            0% { transform: scale(0.2); opacity: 0; }
            20% { transform: scale(1.2); opacity: 1; }
            80% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.2); opacity: 0; }
        }
    </style>
</head>
<body class="bg-green-200">
    <div id="root"></div>
    <script type="module">
      import React, { useState, useEffect, useCallback, useMemo, memo, StrictMode } from 'react';
      import ReactDOM from 'react-dom/client';

      // --- Game Configuration ---
      const LEVEL_CONFIG = {
          1: { scoreToPass: 10, interval: 1000, duration: 25 },
          2: { scoreToPass: 15, interval: 850, duration: 25 },
          3: { scoreToPass: 20, interval: 700, duration: 20 },
          4: { scoreToPass: 25, interval: 550, duration: 20 },
          5: { scoreToPass: 30, interval: 400, duration: 15 },
      };
      const MAX_LEVEL = Object.keys(LEVEL_CONFIG).length;

      const DIFFICULTY_MODIFIERS = {
        'Ïâ¨ÏõÄ': { interval: 1.2, score: 0.8 },
        'Î≥¥ÌÜµ': { interval: 1.0, score: 1.0 },
        'Ïñ¥Î†§ÏõÄ': { interval: 0.8, score: 1.2 },
      };

      const GAME_LENGTH_MODIFIERS = {
        'ÏßßÍ≤å': { duration: 0.7, score: 0.8 },
        'Î≥¥ÌÜµ': { duration: 1.0, score: 1.0 },
        'Í∏∏Í≤å': { duration: 1.5, score: 1.4 },
      };
      
      const FEVER_COMBO_THRESHOLD = 10;
      const FEVER_DURATION_SECONDS = 7;

      const JOB_CONFIG = {
          'ÎÜçÎ∂Ä': { name: 'ÎÜçÎ∂Ä', description: 'ÎëêÎçîÏßÄ 10ÎßàÎ¶¨ÎßàÎã§ +2 Î≥¥ÎÑàÏä§ Ï†êÏàò', icon: 'üë®‚Äçüåæ' },
          'Í¥ëÎ∂Ä': { name: 'Í¥ëÎ∂Ä', description: 'Ìè≠ÌÉÑ Ìå®ÎÑêÌã∞ Í∞êÏÜå (-1Ï†ê)', icon: '‚õèÔ∏è' },
          'ÏãúÍ∞Ñ Ïó¨ÌñâÏûê': { name: 'ÏãúÍ∞Ñ Ïó¨ÌñâÏûê', description: '5Ï¥àÍ∞Ñ Í≤åÏûÑ ÏÜçÎèÑ 50% Í∞êÏÜå (Ïø®ÌÉÄÏûÑ 20Ï¥à)', icon: '‚è≥' },
          'ÏóîÏßÄÎãàÏñ¥': { name: 'ÏóîÏßÄÎãàÏñ¥', description: 'ÏãúÍ≥ÑÍ∞Ä +3Ï¥àÎ•º Î∂ÄÏó¨ÌïòÍ≥†, Î†àÎ≤® ÏãúÏûë Ïãú +5Ï¥àÎ•º ÏñªÏäµÎãàÎã§.', icon: '‚öôÔ∏è' },
          'Ï†êÏÑ±Ïà†ÏÇ¨': { name: 'Ï†êÏÑ±Ïà†ÏÇ¨', description: 'Í∞ÄÎÅîÏî© Îã§Ïùå ÎëêÎçîÏßÄ ÏúÑÏπòÎ•º ÎØ∏Î¶¨ ÏïåÎ†§Ï§çÎãàÎã§.', icon: '‚ú®' },
          'ÎèÑÎ∞ïÏÇ¨': { name: 'ÎèÑÎ∞ïÏÇ¨', description: 'ÌÉÄÍ≤© Ïãú 10% ÌôïÎ•†Î°ú Ï†êÏàò 2Î∞∞, 5% ÌôïÎ•†Î°ú 0Ï†ê', icon: 'üé≤' },
          'ÏàòÏßëÍ∞Ä': { name: 'ÏàòÏßëÍ∞Ä', description: 'Í≤åÏûÑ Ï¢ÖÎ£å Ïãú ÌöçÎìù Í≥®Îìú 20% Ï¶ùÍ∞Ä', icon: 'üí∞' },
          'Î≥¥ÏÑùÏÉÅ': { name: 'Î≥¥ÏÑùÏÉÅ', description: 'Ìù¨Í∑Ä ÎëêÎçîÏßÄ(Ìô©Í∏à, ÏöîÏ†ï Îì±) Îì±Ïû• ÌôïÎ•†Ïù¥ Ï¶ùÍ∞ÄÌï©ÎãàÎã§.', icon: 'üíé' },
          'ÏöîÎ¶¨ÏÇ¨': { name: 'ÏöîÎ¶¨ÏÇ¨', description: 'ÏãúÍ≥Ñ ÏïÑÏù¥ÌÖú ÌöçÎìù Ïãú +1Ï†êÏùÑ Ï∂îÍ∞ÄÎ°ú ÏñªÏäµÎãàÎã§.', icon: 'üë®‚Äçüç≥' },
          'Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä': { name: 'Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä', description: 'Ìè≠ÌÉÑÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ìï¥Ï≤¥ÌïòÎ©¥ Ìå®ÎÑêÌã∞ ÎåÄÏã† +5Ï†êÏùÑ ÏñªÏäµÎãàÎã§.', icon: 'üí£' },
          'ÏûêÏó∞Ï£ºÏùòÏûê': { name: 'ÏûêÏó∞Ï£ºÏùòÏûê', description: 'Í≤åÏûÑ ÏãúÏûë Ïãú ÎëêÎçîÏßÄ ÎØ∏ÎÅº 1Í∞úÎ•º Í∞ÄÏßÄÍ≥† ÏãúÏûëÌï©ÎãàÎã§.', icon: 'üåø' },
          'ÎåÄÏû•Ïû•Ïù¥': { name: 'ÎåÄÏû•Ïû•Ïù¥', description: 'ÏòÅÍµ¨ Í∞ïÌôî ÏóÖÍ∑∏Î†àÏù¥Îìú ÎπÑÏö©Ïù¥ 10% Í∞êÏÜåÌï©ÎãàÎã§.', icon: 'üõ†Ô∏è' },
          'ÏÇ¨ÎÉ•Íæº': { name: 'ÏÇ¨ÎÉ•Íæº', description: 'ÎëêÎçîÏßÄÎ•º ÎÜìÏπòÏßÄ ÏïäÍ≥† 5Î≤à Ïó∞ÏÜçÏúºÎ°ú Ïû°ÏúºÎ©¥ ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§ +5Ï†ê.', icon: 'üéØ' },
          'ÏùÄÌñâÍ∞Ä': { name: 'ÏùÄÌñâÍ∞Ä', description: 'Í≤åÏûÑ ÏãúÏûë Ïãú ÌòÑÏû¨ Î≥¥Ïú† Í≥®ÎìúÏùò 1%Î•º Î≥¥ÎÑàÏä§Î°ú Î∞õÏäµÎãàÎã§ (ÏµúÎåÄ 50Í≥®Îìú).', icon: 'üè¶' },
          'ÎßàÎ≤ïÏÇ¨': { name: 'ÎßàÎ≤ïÏÇ¨', description: 'Í∞ÄÎÅîÏî© Ìè≠ÌÉÑÏùÑ Ï†êÏàòÎ•º Ï£ºÎäî Î≥¥ÏÑùÏúºÎ°ú Î∞îÍøâÎãàÎã§.', icon: 'üßô' },
          'ÏùòÏÇ¨': { name: 'ÏùòÏÇ¨', description: 'Ìè≠ÌÉÑÏúºÎ°ú Ïù∏Ìïú Ï†êÏàò Í∞êÏÜå Ìå®ÎÑêÌã∞Í∞Ä 50% Ï§ÑÏñ¥Îì≠ÎãàÎã§.', icon: 'üë®‚Äç‚öïÔ∏è' },
          'Ïó∞Í∏àÏà†ÏÇ¨': { name: 'Ïó∞Í∏àÏà†ÏÇ¨', description: 'ÎëêÎçîÏßÄÎ•º Ïû°ÏùÑ ÎïåÎßàÎã§ 15% ÌôïÎ•†Î°ú 1Í≥®ÎìúÎ•º Ï∂îÍ∞ÄÎ°ú ÏñªÏäµÎãàÎã§.', icon: '‚öóÔ∏è' },
          'ÏùåÏïÖÍ∞Ä': { name: 'ÏùåÏïÖÍ∞Ä', description: 'Î™®Îì† Î≤ÑÌîÑÏùò ÏßÄÏÜç ÏãúÍ∞ÑÏù¥ 20% Ï¶ùÍ∞ÄÌï©ÎãàÎã§.', icon: 'üéµ' },
          'ÌÉêÌóòÍ∞Ä': { name: 'ÌÉêÌóòÍ∞Ä', description: 'Í≤åÏûÑÌåê ÌÅ¨Í∏∞Í∞Ä 4x4 Ïù¥ÏÉÅÏùº Îïå ÏãúÏûë Ïãú +5Ï¥àÎ•º ÏñªÏäµÎãàÎã§.', icon: 'üß≠' },
          'ÎãåÏûê': { name: 'ÎãåÏûê', description: 'ÎëêÎçîÏßÄ Îì±Ïû•/ÏÇ¨ÎùºÏßÄÎäî ÏÜçÎèÑ 15% Ï¶ùÍ∞Ä, ÎëêÎçîÏßÄ Í∏∞Î≥∏ Ï†êÏàò +1.', icon: 'ü•∑' },
          'Ïú†Î†π': { name: 'Ïú†Î†π', description: 'Ìè≠ÌÉÑÏùÑ Ï≥êÎèÑ 25% ÌôïÎ•†Î°ú Ìå®ÎÑêÌã∞Î•º Î¨¥ÏãúÌï©ÎãàÎã§.', icon: 'üëª' },
      };
      
      const PET_CONFIG = {
        'golden_mole': { name: 'Ìô©Í∏à ÎëêÎçîÏßÄ', icon: 'üåü', description: 'Ï¶âÏãú 10Í≥®Îìú ÌöçÎìù Î∞è 5Ï¥àÍ∞Ñ Ï†êÏàò 2Î∞∞' },
        'fairy_mole': { name: 'ÏöîÏ†ï ÎëêÎçîÏßÄ', icon: 'üßö', description: 'Ï¶âÏãú 5Ï¥à Ï∂îÍ∞Ä Î∞è 10Ï¥àÍ∞Ñ ÎëêÎçîÏßÄ Îì±Ïû• ÎπàÎèÑ Ï¶ùÍ∞Ä' },
        'lucky_clover': { name: 'ÌñâÏö¥ ÌÅ¥Î°úÎ≤Ñ ÎëêÎçîÏßÄ', icon: 'üçÄ', description: 'ÎïåÎïåÎ°ú ÏïΩÍ∞ÑÏùò Í≥®ÎìúÎ•º ÌöçÎìùÌï©ÎãàÎã§ (1-5 G).' },
        'tank_mole': { name: 'ÌäºÌäº ÎëêÎçîÏßÄ', icon: 'üõ°Ô∏è', description: 'Îëê Î≤à ÎïåÎ†§Ïïº Ïû°ÏùÑ Ïàò ÏûàÏäµÎãàÎã§! (+3Ï†ê, +2Í≥®Îìú)' },
        'gem_mole': { name: 'Î≥¥ÏÑù ÎëêÎçîÏßÄ', icon: 'üíé', description: 'Ïû°ÏúºÎ©¥ +3Ï†êÏùÑ Ï§çÎãàÎã§.' },
        'mystery_box_mole': { name: 'ÎØ∏Ïä§ÌÑ∞Î¶¨ Î∞ïÏä§ ÎëêÎçîÏßÄ', icon: 'üéÅ', description: 'Î¨¥ÏóáÏù¥ ÎÇòÏò¨ÏßÄ Î™®Î•¥Îäî ÏÉÅÏûêÏûÖÎãàÎã§. ÌñâÏö¥ÏùÑ ÎπåÏñ¥Ïöî!' },
        'thief_mole': { name: 'ÎèÑÎëë ÎëêÎçîÏßÄ', icon: 'üë∫', description: 'Í≥®ÎìúÎ•º ÌõîÏπ©ÎãàÎã§! Ïû°ÏïÑÏÑú 2Î∞∞Î°ú ÎèåÎ†§Î∞õÏúºÏÑ∏Ïöî!' },
        'king_mole': { name: 'ÎëêÎçîÏßÄ Ïôï', icon: 'üëë', description: 'ÏÑ∏ Î≤à ÎïåÎ†§Ïïº Ìï©ÎãàÎã§! ÏóÑÏ≤≠ÎÇú Î≥¥ÏÉÅÏùÑ Ï§çÎãàÎã§! (+10Ï†ê, +15Í≥®Îìú)' },
        'joker_mole': { name: 'Í¥ëÎåÄ ÎëêÎçîÏßÄ', icon: 'üÉè', description: 'ÏòàÏ∏°Ìï† Ïàò ÏóÜÎäî Ìö®Í≥ºÎ•º ÏùºÏúºÌÇµÎãàÎã§!' },
      };

      const SHOP_ITEMS = {
        powerups: [
          { id: 'mole_bait', name: 'ÎëêÎçîÏßÄ ÎØ∏ÎÅº', description: '5Ï¥àÍ∞Ñ ÎëêÎçîÏßÄÎßå ÎÇòÌÉÄÎÇòÍ≤å Ìï©ÎãàÎã§.', price: 50, icon: 'üçñ' },
          { id: 'bomb_defusal_kit', name: 'Ìè≠ÌÉÑ Ìï¥Ï≤¥ ÌÇ§Ìä∏', description: 'Îã§Ïùå Ìè≠ÌÉÑ 1Í∞úÎ•º Î¨¥Ìö®ÌôîÌï©ÎãàÎã§.', price: 75, icon: 'üîß' }
        ],
        upgrades: [
          { id: 'mole_score', name: 'Í∞ïÌôîÎêú ÎßùÏπò', description: 'ÎëêÎçîÏßÄ Í∏∞Î≥∏ Ï†êÏàòÎ•º 1Ï†ê Ï¶ùÍ∞ÄÏãúÌÇµÎãàÎã§.', price: 200, icon: 'üî®', maxLevel: 5 },
          { id: 'clock_time', name: 'Ï†ïÎ∞Ä ÏãúÍ≥Ñ', description: 'ÏãúÍ≥Ñ ÏïÑÏù¥ÌÖúÏùò ÏãúÍ∞Ñ Ï¶ùÍ∞ÄÎüâÏùÑ 1Ï¥à ÎäòÎ¶ΩÎãàÎã§.', price: 250, icon: '‚è±Ô∏è', maxLevel: 5 },
          { id: 'gold_bonus', name: 'Í≥®Îìú ÌÉêÏßÄÍ∏∞', description: 'Í≤åÏûÑ Ï¢ÖÎ£å Ïãú ÌöçÎìùÌïòÎäî Í≥®ÎìúÍ∞Ä 5% Ï¶ùÍ∞ÄÌï©ÎãàÎã§.', price: 400, icon: 'ü™ô', maxLevel: 10 },
        ],
        jobs: [
          { id: 'ÏóîÏßÄÎãàÏñ¥', name: 'ÏóîÏßÄÎãàÏñ¥', description: JOB_CONFIG['ÏóîÏßÄÎãàÏñ¥'].description, price: 500, icon: '‚öôÔ∏è' },
          { id: 'Ï†êÏÑ±Ïà†ÏÇ¨', name: 'Ï†êÏÑ±Ïà†ÏÇ¨', description: JOB_CONFIG['Ï†êÏÑ±Ïà†ÏÇ¨'].description, price: 750, icon: '‚ú®' },
          { id: 'ÎèÑÎ∞ïÏÇ¨', name: 'ÎèÑÎ∞ïÏÇ¨', description: JOB_CONFIG['ÎèÑÎ∞ïÏÇ¨'].description, price: 600, icon: 'üé≤' },
          { id: 'ÏàòÏßëÍ∞Ä', name: 'ÏàòÏßëÍ∞Ä', description: JOB_CONFIG['ÏàòÏßëÍ∞Ä'].description, price: 600, icon: 'üí∞' },
          { id: 'Î≥¥ÏÑùÏÉÅ', name: 'Î≥¥ÏÑùÏÉÅ', description: JOB_CONFIG['Î≥¥ÏÑùÏÉÅ'].description, price: 800, icon: 'üíé' },
          { id: 'ÏöîÎ¶¨ÏÇ¨', name: 'ÏöîÎ¶¨ÏÇ¨', description: JOB_CONFIG['ÏöîÎ¶¨ÏÇ¨'].description, price: 400, icon: 'üë®‚Äçüç≥' },
          { id: 'Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä', name: 'Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä', description: JOB_CONFIG['Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä'].description, price: 1000, icon: 'üí£' },
          { id: 'ÏûêÏó∞Ï£ºÏùòÏûê', name: 'ÏûêÏó∞Ï£ºÏùòÏûê', description: JOB_CONFIG['ÏûêÏó∞Ï£ºÏùòÏûê'].description, price: 550, icon: 'üåø' },
          { id: 'ÎåÄÏû•Ïû•Ïù¥', name: 'ÎåÄÏû•Ïû•Ïù¥', description: JOB_CONFIG['ÎåÄÏû•Ïû•Ïù¥'].description, price: 1200, icon: 'üõ†Ô∏è' },
          { id: 'ÏÇ¨ÎÉ•Íæº', name: 'ÏÇ¨ÎÉ•Íæº', description: JOB_CONFIG['ÏÇ¨ÎÉ•Íæº'].description, price: 900, icon: 'üéØ' },
          { id: 'ÏùÄÌñâÍ∞Ä', name: 'ÏùÄÌñâÍ∞Ä', description: JOB_CONFIG['ÏùÄÌñâÍ∞Ä'].description, price: 1500, icon: 'üè¶' },
          { id: 'ÎßàÎ≤ïÏÇ¨', name: 'ÎßàÎ≤ïÏÇ¨', description: JOB_CONFIG['ÎßàÎ≤ïÏÇ¨'].description, price: 1300, icon: 'üßô' },
          { id: 'ÏùòÏÇ¨', name: 'ÏùòÏÇ¨', description: JOB_CONFIG['ÏùòÏÇ¨'].description, price: 700, icon: 'üë®‚Äç‚öïÔ∏è' },
          { id: 'Ïó∞Í∏àÏà†ÏÇ¨', name: 'Ïó∞Í∏àÏà†ÏÇ¨', description: JOB_CONFIG['Ïó∞Í∏àÏà†ÏÇ¨'].description, price: 1100, icon: '‚öóÔ∏è' },
          { id: 'ÏùåÏïÖÍ∞Ä', name: 'ÏùåÏïÖÍ∞Ä', description: JOB_CONFIG['ÏùåÏïÖÍ∞Ä'].description, price: 850, icon: 'üéµ' },
          { id: 'ÌÉêÌóòÍ∞Ä', name: 'ÌÉêÌóòÍ∞Ä', description: JOB_CONFIG['ÌÉêÌóòÍ∞Ä'].description, price: 650, icon: 'üß≠' },
          { id: 'ÎãåÏûê', name: 'ÎãåÏûê', description: JOB_CONFIG['ÎãåÏûê'].description, price: 1400, icon: 'ü•∑' },
          { id: 'Ïú†Î†π', name: 'Ïú†Î†π', description: JOB_CONFIG['Ïú†Î†π'].description, price: 950, icon: 'üëª' },
        ]
      };

      const BOMB_PROBABILITY = 0.08;
      const ITEM_PROBABILITY = 0.10;
      const PET_PROBABILITY = 0.05;
      const CURSED_MOLE_PROBABILITY = 0.04;
      const THIEF_MOLE_PROBABILITY = 0.04;
      const KING_MOLE_PROBABILITY = 0.01;
      const JOKER_MOLE_PROBABILITY = 0.04;

      // --- SVG Icons ---
      const HammerIcon = () => ( React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6 inline-block mr-2", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" })) );
      const TimerIcon = () => ( React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6 inline-block mr-2", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" })) );
      const GoldIcon = () => ( React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5 inline-block mr-1 text-yellow-500", viewBox: "0 0 20 20", fill: "currentColor" }, React.createElement('path', { fillRule: "evenodd", d: "M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z", clipRule: "evenodd" })) );
      
      const BombIcon = ({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-gray-800 rounded-full border-4 border-black flex justify-center items-start" }, React.createElement('div', { className: "w-2 h-4 bg-gray-500 rounded-t-sm" }))) );
      const ClockIcon = ({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-blue-400 rounded-full border-4 border-blue-800 flex justify-center items-center" }, React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-2/3 w-2/3 text-white", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" })))) );
      const GoldenMole = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-yellow-400 rounded-full border-4 border-yellow-600 animate-pulse" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }), React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üåü"))) ));
      const FairyMole = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-pink-300 rounded-full border-4 border-pink-500" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-white rounded-t-full rounded-b-sm" }), React.createElement('div', { className: "absolute top-0 left-0 -translate-x-1/4 -translate-y-1/4 text-xl rotate-[-30deg]" }, "üßö"))) ));
      const LuckyClover = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-green-600 rounded-full border-4 border-green-800" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }), React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üçÄ"))) ));
      const GemMole = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-cyan-400 rounded-full border-4 border-cyan-600 animate-pulse" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-white rounded-t-full rounded-b-sm" }), React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üíé"))) ));
      const CursedMole = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-purple-700 rounded-full border-4 border-purple-900" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-red-500 rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-red-500 rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-black rounded-t-sm rounded-b-full" }), React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üíÄ"))) ));
      const TankMole = memo(({ isVisible, hits }) => (
        React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` },
          React.createElement('div', { className: "absolute inset-0 bg-slate-500 rounded-full border-4 border-slate-700" },
            React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }),
            React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }),
            React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }),
            React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üõ°Ô∏è"),
            hits === 1 && (
              React.createElement('div', { className: "absolute inset-0 flex items-center justify-center opacity-70" },
                React.createElement('svg', { viewBox: "0 0 100 100", className: "w-full h-full text-white" },
                  React.createElement('path', { d: "M 25 35 L 75 65 M 40 75 L 60 25 M 20 60 L 80 40", stroke: "currentColor", strokeWidth: "4", fill: "none", strokeLinecap: "round" })
                )
              )
            )
          )
        )
      ));
      const MysteryBoxMole = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-amber-700 rounded-full border-4 border-black/80" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }), React.createElement('div', { className: "absolute -top-4 left-1/2 -translate-x-1/2 text-4xl" }, "üéÅ"))) ));
      const ThiefMole = memo(({ isVisible, stolenGold }) => (
        React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` },
            React.createElement('div', { className: "absolute inset-0 bg-gray-600 rounded-full border-4 border-gray-800" },
                React.createElement('div', { className: "absolute top-1/4 left-0 right-0 h-1/4 bg-black" }),
                React.createElement('div', { className: "absolute top-[30%] left-[20%] w-1/6 h-1/6 bg-white rounded-full" }),
                React.createElement('div', { className: "absolute top-[30%] right-[20%] w-1/6 h-1/6 bg-white rounded-full" }),
                React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }),
                React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üë∫"),
                stolenGold && (
                    React.createElement('div', { className: "absolute -bottom-2 -right-2 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full shadow-md" },
                        `-${stolenGold}G`
                    )
                )
            )
        )
    ));
    const KingMole = memo(({ isVisible, hits }) => (
        React.createElement('div', { className: `relative w-[95%] h-[95%] transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` },
            React.createElement('div', { className: "absolute inset-0 bg-purple-600 rounded-full border-4 border-yellow-400" },
                React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-white rounded-full border-2 border-black" }, React.createElement('div', { className: "w-1/2 h-1/2 bg-black rounded-full mx-auto my-auto" })),
                React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-white rounded-full border-2 border-black" }, React.createElement('div', { className: "w-1/2 h-1/2 bg-black rounded-full mx-auto my-auto" })),
                React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }),
                React.createElement('div', { className: "absolute -top-4 left-1/2 -translate-x-1/2 text-4xl" }, "üëë"),
                React.createElement('div', { className: "absolute -bottom-1 left-1/2 -translate-x-1/2 flex gap-1" },
                    Array.from({ length: 3 }).map((_, i) => (
                        React.createElement('span', { key: i, className: `text-xl ${i < (hits ?? 3) ? 'text-red-500' : 'text-gray-500'}` }, "‚ô•")
                    ))
                )
            )
        )
    ));
    const JokerMole = memo(({ isVisible }) => (
        React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` },
            React.createElement('div', { className: "absolute inset-0 bg-gradient-to-br from-red-500 via-yellow-300 to-blue-500 rounded-full border-4 border-purple-600" },
                React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }),
                React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }),
                React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-white rounded-t-full rounded-b-sm" }),
                React.createElement('div', { className: "absolute -top-2 left-1/2 -translate-x-1/2 text-2xl" }, "üÉè")
            )
        )
    ));

      // --- Child Components ---
      const Mole = memo(({ isVisible }) => ( React.createElement('div', { className: `relative w-4/5 h-4/5 transition-transform duration-100 ease-out transform ${isVisible ? 'translate-y-0' : 'translate-y-full'}` }, React.createElement('div', { className: "absolute inset-0 bg-amber-700 rounded-full border-4 border-black/80" }, React.createElement('div', { className: "absolute top-1/4 left-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/4 right-[20%] w-1/6 h-1/4 bg-black rounded-full" }), React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/4 h-1/5 bg-pink-300 rounded-t-full rounded-b-sm" }))) ));
      const Hole = memo(({ entity, onWhack, canWhack, isHinted }) => {
          const isVisible = entity.type !== 'empty';
          const renderEntity = () => {
              switch (entity.type) {
                  case 'mole': return React.createElement(Mole, { isVisible: isVisible });
                  case 'bomb': return React.createElement(BombIcon, { isVisible: isVisible });
                  case 'clock': return React.createElement(ClockIcon, { isVisible: isVisible });
                  case 'cursed_mole': return React.createElement(CursedMole, { isVisible: isVisible });
                  case 'pet':
                      switch(entity.subType) {
                          case 'golden_mole': return React.createElement(GoldenMole, { isVisible: isVisible });
                          case 'fairy_mole': return React.createElement(FairyMole, { isVisible: isVisible });
                          case 'lucky_clover': return React.createElement(LuckyClover, { isVisible: isVisible });
                          case 'tank_mole': return React.createElement(TankMole, { isVisible: isVisible, hits: entity.hits });
                          case 'gem_mole': return React.createElement(GemMole, { isVisible: isVisible });
                          case 'mystery_box_mole': return React.createElement(MysteryBoxMole, { isVisible: isVisible });
                          case 'thief_mole': return React.createElement(ThiefMole, { isVisible: isVisible, stolenGold: entity.stolenGold });
                          case 'king_mole': return React.createElement(KingMole, { isVisible: isVisible, hits: entity.hits });
                          case 'joker_mole': return React.createElement(JokerMole, { isVisible: isVisible });
                          default: return null;
                      }
                  default: return null;
              }
          };
          return ( React.createElement('div', { className: `w-full h-full bg-yellow-900/60 rounded-full overflow-hidden flex items-end justify-center pt-4 shadow-inner relative transition-shadow ${isHinted ? 'ring-4 ring-purple-400 ring-opacity-75 animate-pulse' : ''}`, onClick: canWhack && isVisible ? onWhack : undefined }, renderEntity()) );
      });

      const ShopModal = ({ isOpen, onClose, gold, powerups, unlockedJobs, upgrades, setGold, setPowerups, setUnlockedJobs, setUpgrades, job }) => {
        if (!isOpen) return null;

        const handlePurchase = (item, type) => {
          let price = item.price;
          if (type === 'upgrade') {
            const currentLevel = upgrades[item.id] || 0;
            price = Math.round(item.price * (1 + currentLevel * 0.5));
            if (job === 'ÎåÄÏû•Ïû•Ïù¥' && unlockedJobs.includes('ÎåÄÏû•Ïû•Ïù¥')) {
              price = Math.round(price * 0.9);
            }
            if (gold >= price && currentLevel < item.maxLevel) {
              setGold(prev => prev - price);
              setUpgrades(prev => ({ ...prev, [item.id]: (prev[item.id] || 0) + 1 }));
            }
          } else if (gold >= price) {
            setGold(prev => prev - price);
            if(type === 'powerup') {
              setPowerups(prev => ({ ...prev, [item.id]: (prev[item.id] || 0) + 1 }));
            } else if(type === 'job') {
              setUnlockedJobs(prev => [...prev, item.id]);
            }
          }
        };

        const renderItem = (item, type) => {
          let name = item.name;
          let description = item.description;
          let price = item.price;
          let ownedStatus;
          let isAffordable = gold >= price;
          let isDisabled = false;

          if (type === 'powerup') {
            ownedStatus = `(Î≥¥Ïú†: ${powerups[item.id] || 0})`;
          } else if (type === 'job') {
            if (unlockedJobs.includes(item.id)) {
              isDisabled = true;
              ownedStatus = 'Î≥¥Ïú†Ï§ë';
            }
          } else if (type === 'upgrade') {
            const currentLevel = upgrades[item.id] || 0;
            price = Math.round(item.price * (1 + currentLevel * 0.5));
            if (job === 'ÎåÄÏû•Ïû•Ïù¥' && unlockedJobs.includes('ÎåÄÏû•Ïû•Ïù¥')) {
              price = Math.round(price * 0.9);
            }
            isAffordable = gold >= price;
            if (currentLevel >= item.maxLevel) {
              isDisabled = true;
              ownedStatus = 'ÏµúÎåÄ Î†àÎ≤®';
            } else {
              ownedStatus = `(Lv. ${currentLevel} / ${item.maxLevel})`;
            }
          }

          isDisabled = isDisabled || !isAffordable;

          return (
            React.createElement('div', { key: `${type}-${item.id}`, className: "flex items-center justify-between p-3 bg-amber-200/50 rounded-lg" },
              React.createElement('div', { className: "flex items-center" },
                React.createElement('div', { className: "text-3xl mr-4" }, item.icon),
                React.createElement('div', {},
                  React.createElement('h4', { className: "font-bold" }, name, React.createElement('span', { className: "text-sm font-normal text-amber-700" }, ` ${ownedStatus}`)),
                  React.createElement('p', { className: "text-xs text-amber-800" }, description)
                )
              ),
              React.createElement('button', {
                onClick: () => handlePurchase(item, type),
                disabled: isDisabled,
                className: `w-28 text-center px-4 py-2 text-sm font-bold text-white rounded-lg shadow-md transition-transform transform hover:scale-105
                  ${isDisabled && ownedStatus !== 'Î≥¥Ïú†Ï§ë' && ownedStatus !== 'ÏµúÎåÄ Î†àÎ≤®' ? 'bg-red-400 cursor-not-allowed' : 
                   ownedStatus === 'Î≥¥Ïú†Ï§ë' || ownedStatus === 'ÏµúÎåÄ Î†àÎ≤®' ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600'}`
              },
                ownedStatus === 'Î≥¥Ïú†Ï§ë' || ownedStatus === 'ÏµúÎåÄ Î†àÎ≤®' ? ownedStatus : `${price} G`
              )
            )
          );
        };
        
        return (
          React.createElement('div', { className: "absolute inset-0 bg-black/60 flex items-center justify-center p-4 z-50" },
            React.createElement('div', { className: "w-full max-w-lg bg-amber-100 rounded-2xl shadow-xl border-4 border-amber-500 p-6 flex flex-col" },
              React.createElement('header', { className: "flex justify-between items-center mb-4 pb-2 border-b-2 border-amber-300" },
                React.createElement('h2', { className: "text-3xl font-bold" }, "ÏÉÅÏ†ê"),
                React.createElement('div', { className: "px-4 py-2 bg-yellow-400/80 rounded-lg font-bold text-amber-900 flex items-center shadow-inner" },
                  React.createElement(GoldIcon, {}), ` ${gold} G`
                ),
                React.createElement('button', { onClick: onClose, className: "text-3xl font-bold hover:text-red-500 transition-colors" }, "√ó")
              ),
              React.createElement('div', { className: "space-y-6 overflow-y-auto max-h-[60vh] pr-2" },
                React.createElement('section', {},
                  React.createElement('h3', { className: "text-xl font-semibold mb-2 text-amber-800" }, "ÏòÅÍµ¨ Í∞ïÌôî"),
                  React.createElement('div', { className: "space-y-2" }, SHOP_ITEMS.upgrades.map(item => renderItem(item, 'upgrade')))
                ),
                React.createElement('section', {},
                  React.createElement('h3', { className: "text-xl font-semibold mb-2 text-amber-800" }, "ÌååÏõåÏóÖ"),
                  React.createElement('div', { className: "space-y-2" }, SHOP_ITEMS.powerups.map(item => renderItem(item, 'powerup')))
                ),
                React.createElement('section', {},
                  React.createElement('h3', { className: "text-xl font-semibold mb-2 text-amber-800" }, "ÏßÅÏóÖ Ìï¥Í∏à"),
                  React.createElement('div', { className: "space-y-2" }, SHOP_ITEMS.jobs.map(item => renderItem(item, 'job')))
                )
              )
            )
          )
        )
      };

      // --- Main App Component ---
      function App() {
        const [gameState, setGameState] = useState('idle');
        const [score, setScore] = useState(0);
        const [earnedGoldInRun, setEarnedGoldInRun] = useState(0);
        const [level, setLevel] = useState(1);
        const [difficulty, setDifficulty] = useState('Î≥¥ÌÜµ');
        const [gameLength, setGameLength] = useState('Î≥¥ÌÜµ');
        const [gridSize, setGridSize] = useState(9);
        const [entities, setEntities] = useState(new Array(gridSize).fill({type: 'empty'}));
        const [job, setJob] = useState('ÎÜçÎ∂Ä');
        const [isShopOpen, setIsShopOpen] = useState(false);
        
        const [highScore, setHighScore] = useState(() => Number(localStorage.getItem('whac-a-mole-highscore') || 0));
        const [gold, setGold] = useState(() => Number(localStorage.getItem('whac-a-mole-gold') || 0));
        const [powerups, setPowerups] = useState(() => JSON.parse(localStorage.getItem('whac-a-mole-powerups') || '{}'));
        const [unlockedJobs, setUnlockedJobs] = useState(() => JSON.parse(localStorage.getItem('whac-a-mole-unlockedJobs') || '["ÎÜçÎ∂Ä", "Í¥ëÎ∂Ä", "ÏãúÍ∞Ñ Ïó¨ÌñâÏûê"]'));
        const [upgrades, setUpgrades] = useState(() => JSON.parse(localStorage.getItem('whac-a-mole-upgrades') || '{"mole_score": 0, "clock_time": 0, "gold_bonus": 0}'));
        
        useEffect(() => { localStorage.setItem('whac-a-mole-gold', gold.toString()); }, [gold]);
        useEffect(() => { localStorage.setItem('whac-a-mole-powerups', JSON.stringify(powerups)); }, [powerups]);
        useEffect(() => { localStorage.setItem('whac-a-mole-unlockedJobs', JSON.stringify(unlockedJobs)); }, [unlockedJobs]);
        useEffect(() => { localStorage.setItem('whac-a-mole-upgrades', JSON.stringify(upgrades)); }, [upgrades]);

        const [molesWhacked, setMolesWhacked] = useState(0);
        const [combo, setCombo] = useState(0);
        const [isSkillActive, setIsSkillActive] = useState(false);
        const [skillCooldown, setSkillCooldown] = useState(0);
        const [scorePulse, setScorePulse] = useState(false);
        const [isMoleBaitActive, setIsMoleBaitActive] = useState(false);
        const [nextMoleHint, setNextMoleHint] = useState(null);
        const [activeBuffs, setActiveBuffs] = useState({});
        const [buffTimers, setBuffTimers] = useState({});
        const [feverActivationMessage, setFeverActivationMessage] = useState(false);
        const [levelEvent, setLevelEvent] = useState(null);
        const [eventMessage, setEventMessage] = useState(null);
        const [displayMessage, setDisplayMessage] = useState(null);

        const gridDimension = useMemo(() => Math.sqrt(gridSize), [gridSize]);
        const timeDilation = isSkillActive ? 1.5 : 1.0;

        const currentLevelConfig = useMemo(() => {
          const baseConfig = LEVEL_CONFIG[level];
          const difficultyModifier = DIFFICULTY_MODIFIERS[difficulty];
          const lengthModifier = GAME_LENGTH_MODIFIERS[gameLength];
          return {
            interval: baseConfig.interval * difficultyModifier.interval,
            duration: Math.round(baseConfig.duration * lengthModifier.duration),
            scoreToPass: Math.round(baseConfig.scoreToPass * difficultyModifier.score * lengthModifier.score),
          };
        }, [level, difficulty, gameLength]);
        
        const effectiveInterval = useMemo(() => {
          let interval = currentLevelConfig.interval * timeDilation;
          if(activeBuffs.moleBoost) interval *= 0.6; // 40% faster
          if (job === 'ÎãåÏûê' && unlockedJobs.includes('ÎãåÏûê')) interval *= 0.85;
          if (levelEvent === 'mole_frenzy') interval *= 0.7;
          if (activeBuffs.hammerSlowdown) interval *= 1.5;
          return interval;
        }, [currentLevelConfig.interval, timeDilation, activeBuffs, job, unlockedJobs, levelEvent]);
        
        const effectivePetProbability = useMemo(() => {
          let prob = PET_PROBABILITY;
          if (job === 'Î≥¥ÏÑùÏÉÅ' && unlockedJobs.includes('Î≥¥ÏÑùÏÉÅ')) prob *= 1.5;
          if (levelEvent === 'gold_rush') prob = 0.5; // Massive boost for gold rush
          return prob;
        }, [job, unlockedJobs, levelEvent]);
        
        const effectiveBombProbability = useMemo(() => {
            if (levelEvent === 'bomb_scare') return BOMB_PROBABILITY * 2;
            return BOMB_PROBABILITY;
        }, [levelEvent]);

        const [timeLeft, setTimeLeft] = useState(currentLevelConfig.duration);
        
        const triggerScorePulse = () => { setScorePulse(true); setTimeout(() => setScorePulse(false), 200); };
        const updateScore = useCallback((change) => {
            if (activeBuffs.scoreFreeze && change > 0) return;
            if (change > 0) setEarnedGoldInRun(prev => prev + change);
            setScore(prevScore => Math.max(0, prevScore + change));
            triggerScorePulse();
        }, [activeBuffs.scoreFreeze]);

        useEffect(() => { setEntities(new Array(gridSize).fill({type: 'empty'})); }, [gridSize]);

        const addBuff = useCallback((buffType, durationSeconds, data = {}) => {
            let finalDuration = durationSeconds;
            if (job === 'ÏùåÏïÖÍ∞Ä' && unlockedJobs.includes('ÏùåÏïÖÍ∞Ä')) {
                finalDuration *= 1.2;
            }
            setActiveBuffs(prev => ({ ...prev, [buffType]: { expiresAt: Date.now() + finalDuration * 1000, ...data } }));
        }, [job, unlockedJobs]);
        
        const startFeverTime = useCallback(() => {
            if (activeBuffs.fever) return;
            setFeverActivationMessage(true);
            setTimeout(() => setFeverActivationMessage(false), 2000);
            addBuff('fever', FEVER_DURATION_SECONDS);
        }, [activeBuffs.fever, addBuff]);
        
        const showDisplayMessage = useCallback((message, isGood) => {
            setDisplayMessage({ message, isGood });
            setTimeout(() => setDisplayMessage(null), 2500);
        }, []);

        const openMysteryBox = useCallback(() => {
            const outcomes = [
                { type: 'good', message: 'üí∞ +25 Í≥®Îìú!', effect: () => setEarnedGoldInRun(g => g + 25) },
                { type: 'good', message: '‚ú® +10 Ï†êÏàò!', effect: () => updateScore(10) },
                { type: 'good', message: 'üî• Ï¶âÏãú ÌîºÎ≤Ñ ÌÉÄÏûÑ!', effect: () => startFeverTime() },
                { type: 'good', message: 'üçñ ÎëêÎçîÏßÄ ÎØ∏ÎÅº ÌöçÎìù!', effect: () => setPowerups(p => ({ ...p, mole_bait: (p.mole_bait || 0) + 1 })) },
                { type: 'bad', message: 'üí£ Ìè≠ÌÉÑ 2Í∞ú Îì±Ïû•!', effect: () => {
                    setEntities(prev => {
                        const newE = [...prev];
                        const emptySpots = newE.map((e, i) => e.type === 'empty' ? i : -1).filter(i => i !== -1);
                        for (let i = 0; i < 2; i++) {
                            if (emptySpots.length > 0) {
                                const spotIdx = emptySpots.splice(Math.floor(Math.random() * emptySpots.length), 1)[0];
                                newE[spotIdx] = { type: 'bomb' };
                            }
                        }
                        return newE;
                    });
                }},
                { type: 'bad', message: 'ü•∂ 3Ï¥àÍ∞Ñ Ï†êÏàò ÌöçÎìù Î∂àÍ∞Ä!', effect: () => addBuff('scoreFreeze', 3) },
                { type: 'bad', message: 'üí∏ -10 Í≥®Îìú!', effect: () => setEarnedGoldInRun(g => Math.max(0, g - 10)) },
            ];
            const chosenOutcome = outcomes[Math.floor(Math.random() * outcomes.length)];
            chosenOutcome.effect();
            showDisplayMessage(chosenOutcome.message, chosenOutcome.type === 'good');
        }, [updateScore, startFeverTime, addBuff, showDisplayMessage]);

        useEffect(() => {
          const timer = setInterval(() => {
            const now = Date.now();
            const newBuffs = { ...activeBuffs };
            let buffsChanged = false;
            Object.keys(newBuffs).forEach(key => {
              if (now >= newBuffs[key].expiresAt) {
                delete newBuffs[key];
                buffsChanged = true;
              }
            });
            if (buffsChanged) setActiveBuffs(newBuffs);
            
            setBuffTimers(() => {
                const newTimers = {};
                Object.keys(newBuffs).forEach(key => {
                    newTimers[key] = Math.ceil((newBuffs[key].expiresAt - now) / 1000);
                });
                return newTimers;
            });
          }, 250);
          return () => clearInterval(timer);
        }, [activeBuffs]);
        
        const finalizeRun = useCallback(() => {
            let goldMultiplier = 1.0;
            if (job === 'ÏàòÏßëÍ∞Ä' && unlockedJobs.includes('ÏàòÏßëÍ∞Ä')) goldMultiplier += 0.2;
            goldMultiplier += (upgrades.gold_bonus || 0) * 0.05;
            const finalGold = Math.ceil(earnedGoldInRun * goldMultiplier);
            setGold(prev => prev + finalGold);

            if (score > highScore) {
                setHighScore(score);
                localStorage.setItem('whac-a-mole-highscore', score.toString());
            }
        }, [earnedGoldInRun, highScore, job, score, unlockedJobs, upgrades.gold_bonus]);

        useEffect(() => {
          if (gameState !== 'playing') return;
          if (timeLeft <= 0) {
            setEntities(new Array(gridSize).fill({type: 'empty'}));
            const passed = score >= currentLevelConfig.scoreToPass;
            if (passed && level < MAX_LEVEL) {
              setGameState('levelComplete');
            } else {
              finalizeRun();
              if (passed && level === MAX_LEVEL) setGameState('gameComplete');
              else setGameState('gameOver');
            }
            return;
          }
          const timerId = setTimeout(() => {
              setTimeLeft(timeLeft - 1);
              if (skillCooldown > 0) setSkillCooldown(prev => prev - 1);
          }, 1000 * timeDilation);
          return () => clearTimeout(timerId);
        }, [gameState, timeLeft, score, gridSize, skillCooldown, timeDilation, level, currentLevelConfig.scoreToPass, finalizeRun]);

        useEffect(() => {
          if (gameState !== 'playing') return;
          const moleIntervalId = setInterval(() => {
            setEntities(prevEntities => {
                const newEntities = new Array(gridSize).fill({ type: 'empty' });
                const numToShow = Math.min(Math.floor(level / 2) + Math.floor(gridSize / 9), Math.floor(gridSize / 2));
                let availableSpots = Array.from(Array(gridSize).keys());
                
                const isFever = !!activeBuffs.fever;

                for(let i=0; i < numToShow; i++) {
                    if (availableSpots.length === 0) break;
                    const spotIndex = availableSpots.splice(Math.floor(Math.random() * availableSpots.length), 1)[0];
                    
                    if(isMoleBaitActive) {
                      newEntities[spotIndex] = { type: 'mole' };
                      continue;
                    }

                    if (levelEvent === 'gold_rush') {
                        if (Math.random() < 0.5) newEntities[spotIndex] = { type: 'pet', subType: 'golden_mole' };
                        else newEntities[spotIndex] = { type: 'mole' };
                        continue;
                    }

                    const rand = Math.random();
                    const canThiefAppear = earnedGoldInRun >= 10;
                    const canKingAppear = level >= 3;
                    
                    const p_king = canKingAppear ? KING_MOLE_PROBABILITY : 0;
                    const p_thief = canThiefAppear ? THIEF_MOLE_PROBABILITY : 0;
                    const p_joker = JOKER_MOLE_PROBABILITY;
                    const p_cursed = CURSED_MOLE_PROBABILITY;
                    const p_pet = effectivePetProbability;
                    const p_bomb = effectiveBombProbability;
                    const p_item = ITEM_PROBABILITY;

                    if (isFever) {
                        if (rand < PET_PROBABILITY + ITEM_PROBABILITY) {
                            const petTypes = Object.keys(PET_CONFIG).filter(p => p !== 'king_mole' && p !== 'thief_mole' && p !== 'joker_mole');
                            const chosenPet = petTypes[Math.floor(Math.random() * petTypes.length)];
                            newEntities[spotIndex] = { type: 'pet', subType: chosenPet, hits: chosenPet === 'tank_mole' ? 2 : undefined };
                        } else {
                            newEntities[spotIndex] = { type: 'mole' };
                        }
                    } else {
                        if (rand < p_king) {
                            newEntities[spotIndex] = { type: 'pet', subType: 'king_mole', hits: 3 };
                        } else if (rand < p_king + p_thief) {
                           const goldToSteal = Math.max(1, Math.min(10, Math.floor(earnedGoldInRun * 0.2)));
                           setEarnedGoldInRun(g => g - goldToSteal);
                           newEntities[spotIndex] = { type: 'pet', subType: 'thief_mole', stolenGold: goldToSteal };
                        } else if (rand < p_king + p_thief + p_joker) {
                            newEntities[spotIndex] = { type: 'pet', subType: 'joker_mole' };
                        } else if (rand < p_king + p_thief + p_joker + p_cursed) {
                            newEntities[spotIndex] = { type: 'cursed_mole' };
                        } else if (rand < p_king + p_thief + p_joker + p_cursed + p_pet) {
                          let petTypes = Object.keys(PET_CONFIG).filter(p => p !== 'thief_mole' && p !== 'king_mole' && p !== 'joker_mole');
                          if(levelEvent === 'tank_outbreak' && Math.random() < 0.5) {
                            newEntities[spotIndex] = { type: 'pet', subType: 'tank_mole', hits: 2};
                          } else {
                            const chosenPet = petTypes[Math.floor(Math.random() * petTypes.length)];
                            const petEntity = { type: 'pet', subType: chosenPet, hits: chosenPet === 'tank_mole' ? 2 : undefined };
                            newEntities[spotIndex] = petEntity;
                          }
                        }
                        else if (rand < p_king + p_thief + p_joker + p_cursed + p_pet + p_bomb) {
                          if (job === 'ÎßàÎ≤ïÏÇ¨' && unlockedJobs.includes('ÎßàÎ≤ïÏÇ¨') && Math.random() < 0.3) {
                            newEntities[spotIndex] = { type: 'pet', subType: 'gem_mole' };
                          } else {
                            newEntities[spotIndex] = { type: 'bomb' };
                          }
                        }
                        else if (rand < p_king + p_thief + p_joker + p_cursed + p_pet + p_bomb + p_item) {
                           newEntities[spotIndex] = { type: 'clock' };
                        }
                        else newEntities[spotIndex] = { type: 'mole' };
                    }
                }
                if (!isMoleBaitActive && job === 'Ï†êÏÑ±Ïà†ÏÇ¨' && unlockedJobs.includes('Ï†êÏÑ±Ïà†ÏÇ¨') && Math.random() < 0.25) {
                    const moleIndices = newEntities.map((e, i) => e.type === 'mole' ? i : -1).filter(i => i !== -1);
                    if (moleIndices.length > 0) {
                        const hintedIndex = moleIndices[Math.floor(Math.random() * moleIndices.length)];
                        setNextMoleHint(hintedIndex);
                        setTimeout(() => setNextMoleHint(null), effectiveInterval * 0.8);
                    }
                } else { setNextMoleHint(null); }
                return newEntities;
            });
          }, effectiveInterval);
          return () => clearInterval(moleIntervalId);
        }, [gameState, gridSize, level, job, unlockedJobs, isMoleBaitActive, effectiveInterval, effectivePetProbability, effectiveBombProbability, activeBuffs.fever, levelEvent, earnedGoldInRun]);
        
        const setupLevel = useCallback((targetLevel, initialScore = 0, initialGold = 0) => {
          setLevel(targetLevel);
          setScore(initialScore);
          setEarnedGoldInRun(initialGold);
          setMolesWhacked(0);
          setCombo(0);
          setSkillCooldown(0);
          setIsSkillActive(false);
          setIsMoleBaitActive(false);
          setNextMoleHint(null);
          setActiveBuffs({});
          setBuffTimers({});
          setLevelEvent(null);
          
          if (targetLevel > 1 && Math.random() < 0.35) { // 35% chance for an event
            const events = ['mole_frenzy', 'bomb_scare', 'gold_rush', 'tank_outbreak'];
            const eventMessages = {'mole_frenzy': 'ÎëêÎçîÏßÄ Í¥ëÎûÄ!', 'bomb_scare': 'Ìè≠ÌÉÑ Ï£ºÏùòÎ≥¥!', 'gold_rush': 'Í≥®Îìú Îü¨Ïãú!', 'tank_outbreak': 'ÌäºÌäº ÎëêÎçîÏßÄ ÎåÄÏ∂úÌòÑ!'};
            const chosenEvent = events[Math.floor(Math.random() * events.length)];
            setLevelEvent(chosenEvent);
            setEventMessage(eventMessages[chosenEvent]);
            setTimeout(() => setEventMessage(null), 3000);
          }

          const newConfig = LEVEL_CONFIG[targetLevel];
          const lengthModifier = GAME_LENGTH_MODIFIERS[gameLength];
          let duration = Math.round(newConfig.duration * lengthModifier.duration);
          if (job === 'ÏóîÏßÄÎãàÏñ¥' && unlockedJobs.includes('ÏóîÏßÄÎãàÏñ¥')) duration += 5;
          if (targetLevel === 1 && job === 'ÌÉêÌóòÍ∞Ä' && unlockedJobs.includes('ÌÉêÌóòÍ∞Ä') && gridSize >= 16) {
              duration += 5;
          }
          setTimeLeft(duration);
          setGameState('playing');
        }, [gameLength, job, unlockedJobs, gridSize]);

        const startGame = useCallback(() => {
          if (job === 'ÏûêÏó∞Ï£ºÏùòÏûê' && unlockedJobs.includes('ÏûêÏó∞Ï£ºÏùòÏûê')) {
            setPowerups(p => ({ ...p, mole_bait: (p.mole_bait || 0) + 1 }));
          }
          let startingGold = 0;
          if (job === 'ÏùÄÌñâÍ∞Ä' && unlockedJobs.includes('ÏùÄÌñâÍ∞Ä')) {
            startingGold = Math.min(Math.floor(gold * 0.01), 50);
          }
          setupLevel(1, 0, startingGold);
        }, [setupLevel, job, unlockedJobs, gold]);
        const startNextLevel = useCallback(() => { level < MAX_LEVEL ? setupLevel(level + 1, score, earnedGoldInRun) : setGameState('gameComplete'); }, [level, setupLevel, score, earnedGoldInRun]);
        
        const restartGame = useCallback(() => {
            setGameState('idle');
            setScore(0);
            setEarnedGoldInRun(0);
            setLevel(1);
            setLevelEvent(null);
            const newConfig = LEVEL_CONFIG[1];
            const lengthMod = GAME_LENGTH_MODIFIERS[gameLength];
            setTimeLeft(Math.round(newConfig.duration * lengthMod.duration));
        }, [gameLength]);
        
        const quitGame = useCallback(() => {
            finalizeRun();
            restartGame();
        }, [finalizeRun, restartGame]);

        const togglePause = useCallback(() => setGameState(prev => (prev === 'playing' ? 'paused' : 'playing')), []);

        const whackHole = useCallback((index) => {
          const entity = entities[index];
          if (entity.type !== 'empty') {
            let scoreChange = 0;
            let isSuccess = false;

            switch (entity.type) {
              case 'mole':
                isSuccess = true;
                setEarnedGoldInRun(prev => prev + 1);
                if (job === 'Ïó∞Í∏àÏà†ÏÇ¨' && unlockedJobs.includes('Ïó∞Í∏àÏà†ÏÇ¨') && Math.random() < 0.15) {
                    setEarnedGoldInRun(prev => prev + 1);
                }
                let baseScore = 1 + (upgrades.mole_score || 0);
                if (job === 'ÎãåÏûê' && unlockedJobs.includes('ÎãåÏûê')) baseScore += 1;
                
                if (activeBuffs.jokerTime) {
                    baseScore = Math.floor(Math.random() * 8) - 2; // -2 to +5
                } else if (job === 'ÎèÑÎ∞ïÏÇ¨' && unlockedJobs.includes('ÎèÑÎ∞ïÏÇ¨')) {
                    const rand = Math.random();
                    if (rand < 0.05) baseScore = 0;
                    else if (rand < 0.15) baseScore *= 2;
                }
                scoreChange = baseScore;
                const newWhackedCount = molesWhacked + 1;
                setMolesWhacked(newWhackedCount);
                if (job === 'ÎÜçÎ∂Ä' && unlockedJobs.includes('ÎÜçÎ∂Ä') && newWhackedCount % 10 === 0) scoreChange += 2;
                break;
              case 'clock':
                isSuccess = true;
                const timeBonus = (job === 'ÏóîÏßÄÎãàÏñ¥' && unlockedJobs.includes('ÏóîÏßÄÎãàÏñ¥') ? 3 : 2) + (upgrades.clock_time || 0);
                setTimeLeft(prevTime => prevTime + timeBonus);
                if (job === 'ÏöîÎ¶¨ÏÇ¨' && unlockedJobs.includes('ÏöîÎ¶¨ÏÇ¨')) scoreChange = 1;
                break;
              case 'cursed_mole':
                isSuccess = false;
                const curses = ['hammerSlowdown', 'scoreFreeze'];
                const chosenCurse = curses[Math.floor(Math.random() * curses.length)];
                if (chosenCurse === 'hammerSlowdown') addBuff('hammerSlowdown', 5);
                else if (chosenCurse === 'scoreFreeze') addBuff('scoreFreeze', 3);
                break;
              case 'bomb':
                if (job === 'Ïú†Î†π' && unlockedJobs.includes('Ïú†Î†π') && Math.random() < 0.25) {
                  scoreChange = 0;
                } else if (job === 'Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä' && unlockedJobs.includes('Ìè≠ÌÉÑ Ï†ÑÎ¨∏Í∞Ä')) {
                  scoreChange = 5;
                  isSuccess = true; // Bomb expert defusal is a success
                } else if((powerups.bomb_defusal_kit || 0) > 0) {
                   setPowerups(p => ({ ...p, bomb_defusal_kit: p.bomb_defusal_kit - 1 }));
                } else {
                   let penalty = (job === 'Í¥ëÎ∂Ä' && unlockedJobs.includes('Í¥ëÎ∂Ä')) ? 2 : 3;
                   if (job === 'ÏùòÏÇ¨' && unlockedJobs.includes('ÏùòÏÇ¨')) penalty *= 0.5;
                   scoreChange = -penalty;
                }
                break;
              case 'pet':
                isSuccess = true;
                switch(entity.subType) {
                    case 'tank_mole':
                        const tankNewHits = (entity.hits ?? 2) - 1;
                        if (tankNewHits > 0) {
                            setEntities(prev => { const newE = [...prev]; newE[index] = { ...newE[index], hits: tankNewHits }; return newE; });
                            return; // Don't process score/combo until fully defeated
                        }
                        scoreChange = 3; setEarnedGoldInRun(g => g + 2);
                        break;
                    case 'king_mole':
                        const kingNewHits = (entity.hits ?? 3) - 1;
                        if (kingNewHits > 0) {
                            setEntities(prev => { const newE = [...prev]; newE[index] = { ...newE[index], hits: kingNewHits }; return newE; });
                            return;
                        }
                        scoreChange = 10; setEarnedGoldInRun(g => g + 15);
                        break;
                    case 'joker_mole':
                        const rand = Math.random();
                        if (rand < 0.30) {
                            const goldGained = Math.floor(Math.random() * 6) + 3;
                            setEarnedGoldInRun(g => g + goldGained);
                            showDisplayMessage(`üÉè +${goldGained} Í≥®Îìú!`, true);
                        } else if (rand < 0.60) {
                            const scoreGained = Math.floor(Math.random() * 4) + 2;
                            scoreChange = scoreGained;
                            showDisplayMessage(`üÉè +${scoreGained} Ï†êÏàò!`, true);
                        } else if (rand < 0.80) {
                            scoreChange = -3;
                            showDisplayMessage(`üÉè -3 Ï†êÏàò...`, false);
                        } else if (rand < 0.95) {
                            showDisplayMessage(`üÉè Ìè≠ÌÉÑ Îì±Ïû•!`, false);
                            setEntities(prev => {
                                const newE = [...prev];
                                const emptySpots = newE.map((e, i) => e.type === 'empty' ? i : -1).filter(i => i !== -1);
                                if (emptySpots.length > 0) {
                                    const spotIdx = emptySpots.splice(Math.floor(Math.random() * emptySpots.length), 1)[0];
                                    newE[spotIdx] = { type: 'bomb' };
                                }
                                return newE;
                            });
                        } else {
                            showDisplayMessage(`üÉè Ï°∞Ïª§ ÌÉÄÏûÑ!`, true);
                            addBuff('jokerTime', 5);
                        }
                        break;
                    case 'golden_mole': setEarnedGoldInRun(g => g + 10); addBuff('scoreDoubled', 5); break;
                    case 'fairy_mole': setTimeLeft(t => t + 5); addBuff('moleBoost', 10); break;
                    case 'lucky_clover': setEarnedGoldInRun(g => g + Math.floor(Math.random() * 5) + 1); break;
                    case 'gem_mole': scoreChange = 3; break;
                    case 'mystery_box_mole': openMysteryBox(); break;
                    case 'thief_mole':
                        const returnedGold = (entity.stolenGold || 0) * 2;
                        setEarnedGoldInRun(g => g + returnedGold);
                        scoreChange = 1;
                        break;
                }
                break;
            }

            // Apply global multipliers
            if (activeBuffs.scoreDoubled && scoreChange > 0) scoreChange *= 2;
            if (activeBuffs.fever && scoreChange > 0) scoreChange *= 2;
            
            if (isSuccess) {
                const newCombo = combo + 1;
                setCombo(newCombo);
                if (job === 'ÏÇ¨ÎÉ•Íæº' && unlockedJobs.includes('ÏÇ¨ÎÉ•Íæº') && newCombo > 0 && newCombo % 5 === 0) {
                    scoreChange += 5;
                }
                if (newCombo > 0 && newCombo % FEVER_COMBO_THRESHOLD === 0) {
                    startFeverTime();
                }
            } else {
                setCombo(0);
            }
            
            if (scoreChange !== 0) updateScore(scoreChange);
            setEntities(prevEntities => { const newEntities = [...prevEntities]; newEntities[index] = { type: 'empty' }; return newEntities; });
          }
        }, [entities, job, molesWhacked, unlockedJobs, powerups, activeBuffs, upgrades, updateScore, combo, startFeverTime, addBuff, openMysteryBox, showDisplayMessage]);

        const handleSkillUse = () => { if (job === 'ÏãúÍ∞Ñ Ïó¨ÌñâÏûê' && skillCooldown === 0 && gameState === 'playing') { setIsSkillActive(true); setSkillCooldown(20); setTimeout(() => setIsSkillActive(false), 5000); }};
        const useMoleBait = () => {
            if ((powerups.mole_bait || 0) > 0 && !isMoleBaitActive && gameState === 'playing') {
                setPowerups(prev => ({ ...prev, mole_bait: prev.mole_bait - 1 }));
                setIsMoleBaitActive(true);
                setTimeout(() => setIsMoleBaitActive(false), 5000);
            }
        };

        const handleMiss = () => {
          if (gameState === 'playing') {
            setCombo(0);
          }
        };

        const renderModalContent = () => {
          let goldMultiplier = 1.0;
          if (job === 'ÏàòÏßëÍ∞Ä' && unlockedJobs.includes('ÏàòÏßëÍ∞Ä')) goldMultiplier += 0.2;
          goldMultiplier += (upgrades.gold_bonus || 0) * 0.05;
          const finalGold = Math.ceil(earnedGoldInRun * goldMultiplier);
          
          switch (gameState) {
            case 'paused': return (React.createElement('div', { className: "text-center bg-black/70 p-8 rounded-2xl shadow-xl border-4 border-gray-500 flex flex-col items-center gap-4" }, React.createElement('h2', { className: "text-5xl font-bold text-white drop-shadow-lg mb-4" }, "ÏùºÏãúÏ†ïÏßÄ"), React.createElement('button', { onClick: togglePause, className: "w-48 px-6 py-3 bg-green-500 text-white font-bold text-xl rounded-lg shadow-md hover:bg-green-600 transition-transform transform hover:scale-105" }, "Í≥ÑÏÜçÌïòÍ∏∞"), React.createElement('button', { onClick: quitGame, className: "w-48 px-6 py-3 bg-red-500 text-white font-bold text-xl rounded-lg shadow-md hover:bg-red-600 transition-transform transform hover:scale-105" }, "Í≤åÏûÑ ÎÇòÍ∞ÄÍ∏∞")));
            case 'levelComplete': return (React.createElement('div', { className: "text-center bg-blue-100 p-8 rounded-2xl shadow-xl border-4 border-blue-400" }, React.createElement('h2', { className: "text-4xl font-bold text-blue-700" }, `Î†àÎ≤® ${level} ÌÅ¥Î¶¨Ïñ¥!`), React.createElement('p', { className: "text-xl mt-2 text-blue-600" }, `Ï†êÏàò: ${score}Ï†ê`), React.createElement('p', { className: "text-lg mt-1" }, "Îã§Ïùå Î†àÎ≤®Î°ú ÏßÑÌñâÌïòÏÑ∏Ïöî!")));
            case 'gameOver': return (React.createElement('div', { className: "text-center bg-red-100 p-8 rounded-2xl shadow-xl border-4 border-red-400" }, React.createElement('h2', { className: "text-4xl font-bold text-red-700" }, "Í≤åÏûÑ Ï¢ÖÎ£å!"), React.createElement('p', { className: "text-xl mt-2 text-red-600" }, `ÏµúÏ¢Ö Ï†êÏàò: ${score}Ï†ê`), React.createElement('p', { className: "text-lg mt-2 font-bold text-yellow-600" }, `ÌöçÎìù Í≥®Îìú: ${finalGold} G`), score < currentLevelConfig.scoreToPass && (React.createElement('p', { className: "text-lg mt-1 text-red-500" }, `Î™©Ìëú Ï†êÏàò(${currentLevelConfig.scoreToPass}Ï†ê)Î•º Îã¨ÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.`))));
            case 'gameComplete': return (React.createElement('div', { className: "text-center bg-green-100 p-8 rounded-2xl shadow-xl border-4 border-green-400" }, React.createElement('h2', { className: "text-4xl font-bold text-green-700" }, "Î™®Îì† Î†àÎ≤® ÌÅ¥Î¶¨Ïñ¥!"), React.createElement('p', { className: "text-xl mt-2 text-green-600" }, `ÏµúÏ¢Ö Ï†êÏàò: ${score}Ï†ê`), React.createElement('p', { className: "text-lg mt-2 font-bold text-yellow-600" }, `ÌöçÎìù Í≥®Îìú: ${finalGold} G`), React.createElement('p', { className: "mt-4" }, "Ï∂ïÌïòÌï©ÎãàÎã§! ÎãπÏã†ÏùÄ ÎëêÎçîÏßÄ Ïû°Í∏∞Ïùò Î™ÖÏàòÏûÖÎãàÎã§!")))
            default: return null;
          }
        };

        return (
          React.createElement('main', { className: "min-h-screen bg-green-200 flex flex-col items-center justify-center p-4 text-amber-900 select-none" },
            React.createElement(ShopModal, { isOpen: isShopOpen, onClose: () => setIsShopOpen(false), gold: gold, powerups: powerups, unlockedJobs: unlockedJobs, upgrades: upgrades, setGold: setGold, setPowerups: setPowerups, setUnlockedJobs: setUnlockedJobs, setUpgrades: setUpgrades, job: job }),
            React.createElement('div', { className: `w-full max-w-2xl mx-auto bg-amber-200/70 p-4 sm:p-8 rounded-3xl shadow-2xl border-8 border-amber-800/50 transition-shadow duration-500 ${activeBuffs.fever ? 'fever-active' : ''}` },
              
              React.createElement('header', { className: "relative text-center mb-4" },
                React.createElement('h1', { className: "text-4xl sm:text-6xl font-extrabold tracking-wider" }, "ÎëêÎçîÏßÄ Ïû°Í∏∞"),
                React.createElement('p', { className: "text-lg text-amber-800 mt-1" }, "ÏÉÅÏ†êÏóêÏÑú ÏïÑÏù¥ÌÖúÏùÑ Íµ¨Îß§ÌïòÍ≥† ÏµúÍ≥† Ï†êÏàòÏóê ÎèÑÏ†ÑÌïòÏÑ∏Ïöî!")
              ),

              React.createElement('div', { className: "grid grid-cols-2 gap-4 bg-amber-100 rounded-lg p-3 sm:p-4 mb-2 text-xl sm:text-2xl font-bold shadow-md" },
                  React.createElement('div', { className: `flex items-center col-span-1 transition-transform duration-200 ${scorePulse ? 'scale-125 text-yellow-500' : ''}` }, React.createElement(HammerIcon, {}), React.createElement('span', {}, `Ï†êÏàò: ${score}`)),
                  React.createElement('div', { className: "flex items-center col-span-1 justify-end" }, React.createElement(TimerIcon, {}), React.createElement('span', {}, `ÏãúÍ∞Ñ: ${timeLeft}`)),
                  React.createElement('div', { className: "col-span-2 text-center text-base sm:text-lg text-amber-700" },
                    React.createElement('span', {}, `Î†àÎ≤®: ${level} (${difficulty})`), React.createElement('span', { className: "mx-2 sm:mx-4" }, "|"),
                    React.createElement('span', {}, `ÏßÅÏóÖ: ${job}`), React.createElement('span', { className: "mx-2 sm:mx-4" }, "|"),
                    React.createElement('span', {}, `Î™©Ìëú: ${currentLevelConfig.scoreToPass}Ï†ê`)
                  )
              ),
              
              React.createElement('div', { className: "h-8 mb-2" },
                gameState === 'playing' && (
                  React.createElement('div', { className: "flex justify-center items-center flex-wrap gap-2 text-center font-bold h-full" },
                    buffTimers.scoreDoubled && React.createElement('span', { className: "text-purple-700 bg-purple-200/50 rounded-lg px-2 py-1 shadow-inner text-sm" }, `üåü Ï†êÏàò 2Î∞∞! (${buffTimers.scoreDoubled}Ï¥à)`),
                    buffTimers.moleBoost && React.createElement('span', { className: "text-pink-700 bg-pink-200/50 rounded-lg px-2 py-1 shadow-inner text-sm" }, `üßö ÏÜçÎèÑ UP! (${buffTimers.moleBoost}Ï¥à)`),
                    buffTimers.fever && React.createElement('span', { className: "text-red-500 bg-red-200/50 rounded-lg px-2 py-1 shadow-inner text-sm animate-pulse" }, `üî• ÌîºÎ≤Ñ! (${buffTimers.fever}Ï¥à)`),
                    buffTimers.jokerTime && React.createElement('span', { className: "text-indigo-700 bg-indigo-200/50 rounded-lg px-2 py-1 shadow-inner text-sm" }, `üÉè Ï°∞Ïª§ ÌÉÄÏûÑ! (${buffTimers.jokerTime}Ï¥à)`),
                    combo > 1 && React.createElement('span', { className: "text-orange-700 bg-orange-200/50 rounded-lg px-2 py-1 shadow-inner text-sm" }, `üéØ ${combo} ÏΩ§Î≥¥`),
                    buffTimers.hammerSlowdown && React.createElement('span', { className: "text-red-700 bg-red-200/50 rounded-lg px-2 py-1 shadow-inner text-sm" }, `üíÄ ÎëîÌôî! (${buffTimers.hammerSlowdown}Ï¥à)`),
                    buffTimers.scoreFreeze && React.createElement('span', { className: "text-gray-700 bg-gray-300/50 rounded-lg px-2 py-1 shadow-inner text-sm" }, `ü•∂ Ï†êÏàò Ï†ïÏßÄ! (${buffTimers.scoreFreeze}Ï¥à)`)
                  )
                )
              ),
              
              React.createElement('div', { className: "text-center text-base sm:text-lg text-amber-700 bg-amber-100 rounded-lg p-2 mb-4 shadow-md flex justify-center items-center gap-6" },
                React.createElement('span', {}, `ÏµúÍ≥† Ï†êÏàò: ${highScore}`),
                React.createElement('span', { className: "font-bold flex items-center" }, React.createElement(GoldIcon, {}), ` ${gold} G`)
              ),

              gameState === 'idle' && (
                React.createElement('div', { className: "text-center my-4 p-3 bg-amber-100/50 rounded-lg space-y-4" },
                  React.createElement('div', {},
                    React.createElement('h3', { className: "font-bold text-lg mb-2" }, "ÏßÅÏóÖ ÏÑ†ÌÉù"),
                    React.createElement('div', { className: "grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4" },
                      unlockedJobs.map(j => (
                        React.createElement('button', { key: j, onClick: () => setJob(j), className: `p-2 sm:p-4 text-sm sm:text-base border-4 rounded-lg transition-all duration-200 ${job === j ? 'bg-orange-500 text-white border-orange-700 scale-105 shadow-lg' : 'bg-white text-amber-900 border-gray-200 hover:bg-gray-100'}` },
                          React.createElement('div', { className: "text-2xl sm:text-4xl" }, JOB_CONFIG[j]?.icon || '?'),
                          React.createElement('div', { className: "font-bold mt-1" }, JOB_CONFIG[j]?.name || j),
                          React.createElement('div', { className: "text-xs mt-1 hidden sm:block h-12" }, JOB_CONFIG[j]?.description)
                        )
                      ))
                    )
                  ),
                  React.createElement('div', { className: "grid sm:grid-cols-3 gap-4 pt-4" },
                    React.createElement('div', {},
                        React.createElement('h3', { className: "font-bold text-lg mb-1" }, "ÎÇúÏù¥ÎèÑ"),
                        React.createElement('div', { className: "inline-flex rounded-md shadow-sm", role: "group" },
                            Object.keys(DIFFICULTY_MODIFIERS).map(d => ( React.createElement('button', { key: d, onClick: () => setDifficulty(d), type: "button", className: `px-4 py-2 text-sm font-medium border first:rounded-l-lg last:rounded-r-lg ${difficulty === d ? 'bg-orange-500 text-white border-orange-600' : 'bg-white text-amber-900 border-gray-200 hover:bg-gray-100'}` }, d)))
                        )
                    ),
                    React.createElement('div', {},
                        React.createElement('h3', { className: "font-bold text-lg mb-1" }, "Í≤åÏûÑ Í∏∏Ïù¥"),
                        React.createElement('div', { className: "inline-flex rounded-md shadow-sm", role: "group" },
                            Object.keys(GAME_LENGTH_MODIFIERS).map(d => ( React.createElement('button', { key: d, onClick: () => setGameLength(d), type: "button", className: `px-4 py-2 text-sm font-medium border first:rounded-l-lg last:rounded-r-lg ${gameLength === d ? 'bg-orange-500 text-white border-orange-600' : 'bg-white text-amber-900 border-gray-200 hover:bg-gray-100'}` }, d)))
                        )
                    ),
                    React.createElement('div', {},
                        React.createElement('h3', { className: "font-bold text-lg mb-1" }, "Í≤åÏûÑÌåê ÌÅ¨Í∏∞"),
                        React.createElement('select', { value: gridSize, onChange: (e) => setGridSize(Number(e.target.value)), className: "px-4 py-2 text-sm font-medium rounded-lg border bg-white text-amber-900 border-gray-200 hover:bg-gray-100 focus:ring-2 focus:ring-orange-500" },
                          Array.from({ length: 9 }, (_, i) => i + 3).map(size => ( React.createElement('option', { key: size, value: size * size }, `${size} x ${size}`)))
                        )
                    )
                  )
                )
              ),
              
              React.createElement('div', { className: "relative" },
                React.createElement('div', {
                  style: { gridTemplateColumns: `repeat(${gridDimension}, 1fr)` }, 
                  className: `grid gap-1 sm:gap-2 w-full aspect-square bg-lime-700 p-2 sm:p-4 rounded-2xl shadow-inner ${gameState === 'playing' ? "cursor-[url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"48\" viewport=\"0 0 100 100\" style=\"fill:black;font-size:24px;\"><text y=\"50%\">üî®</text></svg>'),_auto]" : "cursor-default"}`,
                  onClick: handleMiss
                },
                  entities.map((entity, index) => ( React.createElement(Hole, { key: index, entity: entity, onWhack: (e) => { e.stopPropagation(); whackHole(index); }, canWhack: gameState === 'playing', isHinted: index === nextMoleHint }) ))
                ),
                feverActivationMessage && (
                  React.createElement('div', { className: "absolute inset-0 flex items-center justify-center pointer-events-none z-10" },
                      React.createElement('h2', { className: "text-6xl sm:text-8xl font-extrabold text-yellow-300 drop-shadow-lg fever-text", style: { WebkitTextStroke: '2px black' } }, "ÌîºÎ≤Ñ ÌÉÄÏûÑ!")
                  )
                ),
                eventMessage && (
                  React.createElement('div', { className: "absolute inset-0 flex items-center justify-center pointer-events-none z-20" },
                      React.createElement('h2', { className: "text-6xl sm:text-8xl font-extrabold text-yellow-300 drop-shadow-lg event-text", style: { WebkitTextStroke: '3px black' } },
                          eventMessage
                      )
                  )
                ),
                displayMessage && (
                    React.createElement('div', { className: "absolute inset-0 flex items-center justify-center pointer-events-none z-30" },
                        React.createElement('div', { className: `p-4 rounded-xl shadow-lg text-white font-bold text-3xl mystery-box-reward ${displayMessage.isGood ? 'bg-blue-500' : 'bg-red-600'}` },
                            displayMessage.message
                        )
                    )
                ),
                (gameState !== 'playing' && gameState !== 'idle') && ( React.createElement('div', { className: "absolute inset-0 bg-black/50 flex items-center justify-center rounded-2xl p-4" }, renderModalContent()) )
              ),
              
              React.createElement('div', { className: "mt-8 text-center flex justify-center items-center flex-wrap gap-4" },
                 gameState === 'idle' && (
                  React.createElement('div', { className: "flex gap-4 w-full" },
                    React.createElement('button', { onClick: startGame, className: "flex-grow px-10 py-4 bg-orange-500 text-white font-bold text-2xl rounded-xl shadow-lg hover:bg-orange-600 transition-all duration-200 transform hover:scale-105" }, "Í≤åÏûÑ ÏãúÏûë"),
                    React.createElement('button', { onClick: () => setIsShopOpen(true), className: "px-8 py-4 bg-sky-500 text-white font-bold text-2xl rounded-xl shadow-lg hover:bg-sky-600 transition-all duration-200 transform hover:scale-105" }, "ÏÉÅÏ†ê")
                  )
                ),
                gameState === 'playing' && React.createElement('button', { onClick: togglePause, className: "px-10 py-4 bg-orange-500 text-white font-bold text-2xl rounded-xl shadow-lg hover:bg-orange-600 transition-all duration-200 transform hover:scale-105" }, "ÏùºÏãúÏ†ïÏßÄ"),
                gameState === 'levelComplete' && React.createElement('button', { onClick: startNextLevel, className: "px-10 py-4 bg-green-500 text-white font-bold text-2xl rounded-xl shadow-lg hover:bg-green-600 transition-all duration-200 transform hover:scale-105" }, "Îã§Ïùå Îã®Í≥Ñ"),
                (gameState === 'gameOver' || gameState === 'gameComplete') && React.createElement('button', { onClick: restartGame, className: "px-10 py-4 bg-blue-500 text-white font-bold text-2xl rounded-xl shadow-lg hover:bg-blue-600 transition-all duration-200 transform hover:scale-105" }, "Îã§Ïãú ÏãúÏûë"),
                
                job === 'ÏãúÍ∞Ñ Ïó¨ÌñâÏûê' && gameState === 'playing' && (
                  React.createElement('button', { onClick: handleSkillUse, disabled: skillCooldown > 0, className: `px-6 py-3 text-white font-bold text-lg rounded-xl shadow-lg transition-all duration-200 transform ${skillCooldown > 0 ? 'bg-gray-500 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-700 hover:scale-105'} ${isSkillActive ? 'animate-pulse ring-4 ring-purple-300' : ''}` },
                      skillCooldown > 0 ? `Ïø®ÌÉÄÏûÑ: ${skillCooldown}Ï¥à` : 'ÏãúÍ∞Ñ ÏôúÍ≥°'
                  )
                ),
                gameState === 'playing' && (powerups.mole_bait || 0) > 0 && (
                  React.createElement('button', { onClick: useMoleBait, disabled: isMoleBaitActive, className: `px-6 py-3 text-white font-bold text-lg rounded-xl shadow-lg transition-all duration-200 transform ${isMoleBaitActive ? 'bg-yellow-700 cursor-not-allowed' : 'bg-yellow-500 hover:bg-yellow-600 hover:scale-105'}` },
                      `üçñ ÎØ∏ÎÅº (${powerups.mole_bait}) ${isMoleBaitActive ? '(ÌôúÏÑ±)' : ''}`
                  )
                )
              )
            )
          )
        );
      }

      const rootElement = document.getElementById('root');
      if (!rootElement) { throw new Error("Could not find root element to mount to"); }
      const root = ReactDOM.createRoot(rootElement);
      root.render(React.createElement(StrictMode, {}, React.createElement(App, {})));
    </script>
</body>
</html>